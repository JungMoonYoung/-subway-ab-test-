# 지하철 이용자 행동 기반 경로 추천 A/B 테스트 시스템

## 프로젝트 개요

본 프로젝트는 지하철 이용자의 경로 선택 행동을 분석하기 위한 **A/B 테스트 기반 시뮬레이션 시스템**입니다.

### 목적
지하철 경로 추천 UI(빠름 중심 vs 편안함 중심)가 사용자 선택 행동과 만족도에 미치는 영향을 A/B Test로 정량화하여, 혼잡도 분산 및 사용자 경험 개선 전략을 데이터 기반으로 검증

### 핵심 요약
- **데이터**: 100,000명 × 5회 반복 = 500,000 rows의 합성 데이터
- **방법론**: 로지스틱 회귀 모델, 반복 측정 통계 분석 (GEE, FDR 보정)
- **주요 성과**: A그룹이 B그룹 대비 빠른 경로 선택률 **5.71%p 높음** (p<0.001)

---

## 실험 설계

### A/B 그룹 정의

본 실험은 100,000명의 사용자를 두 그룹으로 랜덤 배정하여 진행했습니다.

| 그룹 | UI 설계 방향 | 특징 | 인원 |
|------|-------------|------|------|
| **A그룹** | **빠름 중심 UI** | "빠른 경로" 정보를 먼저 강조<br>시간 절약을 우선 표시 | 50,000명 |
| **B그룹** | **편안함 중심 UI** | "여유 경로" 정보를 먼저 강조<br>혼잡도 정보를 우선 표시 | 50,000명 |

### 경로 선택지

사용자는 매 Trial마다 두 경로 중 하나를 선택합니다:

| 경로 | 특징 | 평균 소요시간 | 평균 혼잡도 |
|------|------|--------------|------------|
| **Fast (빠른 경로)** | 소요시간 짧음, 혼잡함 | 25분 | 85% |
| **Relax (여유 경로)** | 소요시간 김, 쾌적함 | 36분 | 45% |

### 반복 측정 설계

각 사용자는 **5회 반복**하여 경로를 선택하며, 매 회차마다:
- 이전 선택 경험이 다음 선택에 영향 (학습 효과)
- 혼잡도가 동적으로 변화 (선택 비율에 따라)
- 개인별 시간 압박, 성향 등이 반영됨

---

## 주요 기능

- 사용자 특성 기반 경로 선택 시뮬레이션
- 학습 효과(Learning Effect) 모델링
- 통계 검정 (Z-test, Chi-square, Mixed-Effects Model, GEE)
- 시각화 및 자동 리포트 생성
- (선택) Streamlit 대시보드

## 설치 방법

### 1. 저장소 클론

```bash
git clone <repository-url>
cd subway-ab-test
```

### 2. 가상환경 생성 (권장)

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 3. 패키지 설치

```bash
pip install -r requirements.txt
```

## 실행 방법

### 1. 전체 데이터 생성 (통합 스크립트)

```bash
python data/generate_complete_data.py
```

**산출물**: `data/synthetic_data_dynamic.parquet` (500,000 rows)

### 2. 통계 분석

```bash
# 기초 통계 검정
python analysis/basic_tests.py

# GEE 모델 분석
python analysis/mixed_models.py
```

**산출물**: `analysis/*.csv` (8개 분석 결과 파일)

### 3. 시각화 생성

```bash
python analysis/visualization.py
```

**산출물**: `figures/*.png` (8개 전문 차트)

### 4. Streamlit 대시보드 실행

```bash
streamlit run app.py
```

브라우저에서 `http://localhost:8501` 접속

## 프로젝트 구조

```
subway-ab-test/
├── data/                  # 데이터 생성 모듈
│   ├── generate_users.py  # 사용자 기본 정보 생성
│   └── users_base.csv     # 생성된 사용자 데이터
├── analysis/              # 통계 분석 모듈
├── notebooks/             # Jupyter Notebooks
├── dashboard/             # Streamlit 대시보드
├── figures/               # 시각화 결과
├── config.py              # 파라미터 설정
├── requirements.txt       # 의존성 패키지
├── SRS.MD                 # 요구사항 명세서
├── PLAN.MD                # 구현 계획서
└── README.md              # 본 문서
```

## 주요 파라미터 (config.py)

- **NUM_USERS**: 100,000 (사용자 수)
- **NUM_TRIALS**: 5 (반복 측정 횟수)
- **RANDOM_SEED**: 42 (재현성 보장)
- **로지스틱 회귀 계수**:
  - BETA_0_A = 0.3 (A그룹 절편)
  - BETA_TIME_PRESSURE = 1.2
  - BETA_PREVIOUS_CHOICE = -0.4 (학습 효과)

## 프로젝트 진행 상황

- [x] DAY 1: 프로젝트 세팅 및 사용자 데이터 생성
- [x] DAY 2: 반복 측정 시뮬레이션
- [x] DAY 3: 선택 행동 모델링 (동적 혼잡도 피드백 시스템)
- [x] DAY 4: 통계 분석 (GEE, FDR 보정)
- [x] DAY 5: 시각화 (8개 전문 차트)
- [x] DAY 6: Streamlit 대시보드 구현

**프로젝트 완료** (2025년 10월 시작 - 12월 완료)

## 기술 스택

- **언어**: Python 3.8+
- **데이터 처리**: Pandas, NumPy, PyArrow (Parquet)
- **통계 분석**: SciPy, Statsmodels (GEE, FDR)
- **시각화**: Matplotlib, Seaborn, Plotly
- **대시보드**: Streamlit

---

## 주요 분석 결과

### 1. A/B Test 성과

| 지표 | A그룹<br>(빠름 중심 UI) | B그룹<br>(편안함 중심 UI) | 차이 | 통계적 유의성 |
|------|------------|------------|------|--------------|
| **Fast 선택률** | 74.04% | 68.33% | **+5.71%p** | **p < 0.001** |
| 표본 수 | 249,670회 | 250,330회 | 500,000회 | z = 44.6 |
| 효과 크기 | - | - | Cohen's h = 0.126 | Small but meaningful |

**핵심 인사이트**:
- UI 설계만으로 사용자 행동을 **5.71%p** 변화시킬 수 있음
- 서울 지하철 일일 이용객 800만 명 기준, **약 45만 명의 경로 선택 유도 가능**
- 통계적으로 매우 유의미 (p<0.001, 우연 확률 0.1% 미만)

### 2. 사용자 행동 예측 요인 (GEE 모델)

| 변수 | 계수 | 해석 | p-value |
|------|------|------|---------|
| **UI 그룹** (A vs B) | +0.330 | A그룹이 Fast 선택 확률 33.0% 증가 | <0.001*** |
| **시간 압박** | +0.936 | 급할수록 Fast 선택 확률 93.6% 증가 | <0.001*** |
| **효율 지향 성향** | +0.595 | 성향 1단계당 Fast 선택 확률 59.5% 증가 | <0.001*** |
| **Trial 증가** (학습 효과) | -0.404 | 경험 누적으로 Fast 선택 확률 40.4% 감소 | <0.001*** |
| **시간 차이** | +0.132 | 시간 차이 1분당 Fast 선택 확률 13.2% 증가 | <0.001*** |
| **혼잡도 차이** | -0.009 | 차이 10%p당 Fast 선택 확률 9.0% 감소 | <0.001*** |

***: p < 0.001 (통계적으로 매우 유의미)

**핵심 인사이트**:
- **시간 압박**이 가장 강력한 예측 요인 (계수 0.936)
- **학습 효과 존재**: Trial 증가 시 Fast 선택률 감소 (혼잡 경험 후 조정)
- **개인화 전략 가능**: 효율 지향 성향 사용자에게 빠른 경로 우선 제시 효과적

### 3. 기술 성과

- ✅ **데이터 규모**: 100,000명 × 5회 = 500,000 rows 생성 및 분석
- ✅ **데이터 최적화**: Parquet 포맷으로 용량 약 80% 절감
- ✅ **시각화**: 8개 전문 차트 + 5개 인터랙티브 대시보드 페이지
- ✅ **통계 방법론**: GEE (반복 측정), FDR 보정 (다중 검정), Effect Size 분석
- ✅ **재현성**: Random Seed 42 고정으로 완전 재현 가능

---

## 문서

- **SRS.MD**: 요구사항 명세서 (상세 설계 문서)
- **PLAN.MD**: 일자별 구현 계획서 (DAY 1~6)

## 라이선스

MIT License

## 프로젝트 개선 이력

### 파라미터 튜닝
초기 시뮬레이션에서 Fast 선택률이 98% 이상으로 나타나 현실성이 부족하다고 판단하여,
로지스틱 회귀 계수를 조정하여 **목표 범위 70-75%**를 달성했습니다.

- 최종 결과: **전체 평균 71.18%** (목표 범위 내 달성)
- Trial별 변화: 초기 92.16% → 중기 57.13% → 후기 65.72% (학습 효과 확인)

---

## 문의

프로젝트 관련 문의사항은 이슈로 남겨주세요.
